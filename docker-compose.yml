# Docker Compose 主配置文件
# 用于统一管理所有 Docker 服务
#
# 使用方式：
#   docker compose up -d                    # 启动所有服务
#   docker compose up -d nginx-proxy-manager  # 启动指定服务
#   docker compose ps                       # 查看所有服务状态
#
# 注意：每个服务也有独立的 docker-compose.yml 在 docker/[service-name]/ 目录下
#       可以独立管理，也可以统一管理

version: '3.8'

services:
  # Nginx Proxy Manager - 反向代理管理工具
  nginx-proxy-manager:
    image: 'jc21/nginx-proxy-manager:latest'
    container_name: nginx-proxy-manager
    restart: unless-stopped
    environment:
      TZ: "Asia/Shanghai"
    ports:
      - '80:80'      # HTTP 端口
      - '443:443'    # HTTPS 端口
      - '81:81'      # 管理界面端口
    volumes:
      - ./docker/nginx-proxy-manager/data:/data
      - ./docker/nginx-proxy-manager/letsencrypt:/etc/letsencrypt
    networks:
      - docker-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:81"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Portainer - Docker 容器管理工具
  portainer:
    image: 'portainer/portainer-ce:latest'
    container_name: portainer
    restart: unless-stopped
    environment:
      TZ: "Asia/Shanghai"
    ports:
      - '9000:9000'   # Web UI 端口
      - '9443:9443'   # HTTPS 端口（可选）
    volumes:
      - ./docker/portainer/data:/data
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - docker-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:9000/api/system/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # 可以在这里添加其他服务
  # webui:
  #   image: 'webui:latest'
  #   ...

networks:
  docker-network:
    driver: bridge
    name: docker-network
