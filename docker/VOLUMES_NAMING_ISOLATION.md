# Docker Volumes å‘½åå’Œéš”ç¦»æœºåˆ¶

## ğŸ¯ ç›´æ¥å›ç­”ä½ çš„é—®é¢˜

### Q1: å‘½åå·æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Ÿåˆ é™¤å®¹å™¨åé‡æ–°å¯åŠ¨èƒ½æ¢å¤æ•°æ®å—ï¼Ÿ

**A:** âœ… **æ˜¯çš„ï¼**

- å‘½åå·æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ Docker å¯¹è±¡
- åˆ é™¤å®¹å™¨ä¸ä¼šåˆ é™¤å·
- é‡æ–°å¯åŠ¨ä¼šå¤ç”¨åŒä¸€ä¸ªå·ï¼Œæ•°æ®ä¼šæ¢å¤

---

### Q2: ä¸¤ä¸ªå®¹å™¨å†™åŒä¸€ä¸ªå·åå­—ä¸ä¼šä¹±å¥—å—ï¼Ÿ

**A:** âœ… **Docker ä¼šè‡ªåŠ¨åŒºåˆ†ï¼**

- Docker Compose ä¼šæ ¹æ®**é¡¹ç›®å**è‡ªåŠ¨ç»™å·ååŠ å‰ç¼€
- ä¸åŒé¡¹ç›®çš„åŒåå·ä¸ä¼šå†²çª
- åŒä¸€é¡¹ç›®å†…çš„å¤šä¸ªå®¹å™¨ä½¿ç”¨åŒåå·ä¼š**å…±äº«æ•°æ®**ï¼ˆè¿™æ˜¯è®¾è®¡å¦‚æ­¤ï¼‰

---

## ğŸ“Š è¯¦ç»†è¯´æ˜

### å‘½åå·çš„ç‹¬ç«‹æ€§

```yaml
# docker/nacos/docker-compose.yml
volumes:
  - nacos_data:/home/nacos/data

volumes:
  nacos_data:
```

**å®é™…åˆ›å»ºçš„å·åï¼š** `nacos_nacos_data`ï¼ˆé¡¹ç›®å_å·åï¼‰

**ç‰¹ç‚¹ï¼š**
1. âœ… å·æ˜¯ç‹¬ç«‹çš„ Docker å¯¹è±¡ï¼Œä¸ä¾èµ–å®¹å™¨
2. âœ… åˆ é™¤å®¹å™¨ï¼Œå·è¿˜åœ¨
3. âœ… é‡æ–°å¯åŠ¨ï¼Œä¼šå¤ç”¨åŒä¸€ä¸ªå·
4. âœ… æ•°æ®ä¼šæ¢å¤

---

### å®é™…æµ‹è¯•

```bash
# 1. å¯åŠ¨ Nacos
cd docker/nacos
docker compose up -d

# 2. åœ¨ Nacos ä¸­åˆ›å»ºä¸€äº›é…ç½®
# è®¿é—® http://localhost:8848/nacosï¼Œåˆ›å»ºé…ç½®

# 3. æŸ¥çœ‹å·å
docker volume ls | grep nacos
# è¾“å‡ºï¼šnacos_nacos_data  nacos_nacos_logs

# 4. åˆ é™¤å®¹å™¨
docker compose down

# 5. æŸ¥çœ‹å·ï¼ˆè¿˜åœ¨ï¼ï¼‰
docker volume ls | grep nacos
# è¾“å‡ºï¼šnacos_nacos_data  nacos_nacos_logsï¼ˆè¿˜åœ¨ï¼‰

# 6. é‡æ–°å¯åŠ¨
docker compose up -d

# 7. æ£€æŸ¥æ•°æ®ï¼ˆåº”è¯¥è¿˜åœ¨ï¼ï¼‰
# è®¿é—®æ§åˆ¶å°ï¼Œä¹‹å‰åˆ›å»ºçš„é…ç½®åº”è¯¥è¿˜åœ¨
```

**ç»“æœï¼š** âœ… æ•°æ®æ¢å¤ï¼Œä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå·

---

## ğŸ” å·åçš„éš”ç¦»æœºåˆ¶

### Docker Compose çš„å‘½åè§„åˆ™

Docker Compose ä¼šè‡ªåŠ¨ç»™å·ååŠ å‰ç¼€ï¼š`é¡¹ç›®å_å·å`

**é¡¹ç›®åè§„åˆ™ï¼š**
1. é»˜è®¤ä½¿ç”¨**ç›®å½•å**ä½œä¸ºé¡¹ç›®å
2. æˆ–è€…ä½¿ç”¨ `-p` å‚æ•°æŒ‡å®šé¡¹ç›®å

---

### ç¤ºä¾‹ 1ï¼šä¸åŒç›®å½•çš„åŒåå·ï¼ˆä¸ä¼šå†²çªï¼‰

**æ–‡ä»¶ 1ï¼š** `docker/mysql/docker-compose.yml`
```yaml
volumes:
  - data:/var/lib/mysql

volumes:
  data:
```

**å®é™…å·åï¼š** `mysql_data`

---

**æ–‡ä»¶ 2ï¼š** `docker/redis/docker-compose.yml`
```yaml
volumes:
  - data:/data

volumes:
  data:
```

**å®é™…å·åï¼š** `redis_data`

**ç»“æœï¼š** âœ… **ä¸ä¼šå†²çªï¼** ä¸¤ä¸ªä¸åŒçš„å·ï¼š
- `mysql_data` - MySQL çš„æ•°æ®
- `redis_data` - Redis çš„æ•°æ®

---

### ç¤ºä¾‹ 2ï¼šåŒä¸€é¡¹ç›®å†…çš„åŒåå·ï¼ˆä¼šå…±äº«ï¼‰

**æ–‡ä»¶ï¼š** `docker/mysql/docker-compose.yml`
```yaml
services:
  mysql:
    volumes:
      - data:/var/lib/mysql
  
  backup:
    volumes:
      - data:/backup  # ä½¿ç”¨åŒä¸€ä¸ªå·

volumes:
  data:
```

**å®é™…å·åï¼š** `mysql_data`ï¼ˆåªæœ‰ä¸€ä¸ªå·ï¼‰

**ç»“æœï¼š** âœ… **ä¼šå…±äº«æ•°æ®ï¼** ä¸¤ä¸ªå®¹å™¨ä½¿ç”¨åŒä¸€ä¸ªå·ï¼š
- `mysql` å®¹å™¨å†™å…¥ `/var/lib/mysql`
- `backup` å®¹å™¨å¯ä»¥è®¿é—® `/backup`ï¼ˆåŒä¸€ä¸ªå·çš„ä¸åŒè·¯å¾„ï¼‰

---

### ç¤ºä¾‹ 3ï¼šä½¿ç”¨ç›¸åŒé¡¹ç›®åï¼ˆä¼šå…±äº«ï¼‰

```bash
# é¡¹ç›® 1
cd docker/mysql
docker compose -p myproject up -d
# åˆ›å»ºå·ï¼šmyproject_data

# é¡¹ç›® 2
cd docker/redis
docker compose -p myproject up -d
# ä½¿ç”¨å·ï¼šmyproject_dataï¼ˆåŒä¸€ä¸ªå·ï¼ï¼‰
```

**ç»“æœï¼š** âš ï¸ **ä¼šå…±äº«ï¼** å› ä¸ºé¡¹ç›®åç›¸åŒï¼Œå·åä¹Ÿç›¸åŒ

---

## ğŸ“‹ å·åç”Ÿæˆè§„åˆ™æ€»ç»“

| åœºæ™¯ | å·åå†™æ³• | å®é™…å·å | æ˜¯å¦å†²çª |
|------|---------|---------|---------|
| ä¸åŒç›®å½•ï¼ŒåŒåå· | `data` | `ç›®å½•1_data`<br>`ç›®å½•2_data` | âŒ ä¸å†²çª |
| åŒä¸€ç›®å½•ï¼Œå¤šä¸ªå®¹å™¨ç”¨åŒåå· | `data` | `ç›®å½•_data` | âœ… å…±äº«ï¼ˆè®¾è®¡å¦‚æ­¤ï¼‰ |
| ç›¸åŒé¡¹ç›®å | `data` | `é¡¹ç›®å_data` | âœ… å…±äº« |
| ä½¿ç”¨ `external: true` | `data` | æŒ‡å®šåç§° | å–å†³äºæŒ‡å®šåç§° |

---

## ğŸ” å¦‚ä½•æŸ¥çœ‹å®é™…å·å

### æ–¹æ³• 1ï¼šæŸ¥çœ‹æ‰€æœ‰å·

```bash
docker volume ls

# è¾“å‡ºç¤ºä¾‹ï¼š
# DRIVER    VOLUME NAME
# local     mysql_data
# local     nacos_nacos_data
# local     redis_data
```

---

### æ–¹æ³• 2ï¼šæŸ¥çœ‹ Compose é¡¹ç›®åˆ›å»ºçš„å·

```bash
cd docker/nacos
docker compose config --volumes

# è¾“å‡ºï¼š
# nacos_data
# nacos_logs
```

**æ³¨æ„ï¼š** è¿™åªæ˜¯ compose æ–‡ä»¶ä¸­å®šä¹‰çš„åç§°ï¼Œå®é™…å·åä¼šæœ‰é¡¹ç›®åå‰ç¼€ã€‚

---

### æ–¹æ³• 3ï¼šæŸ¥çœ‹å®¹å™¨ä½¿ç”¨çš„å·

```bash
docker inspect nacos | jq '.[0].Mounts'

# è¾“å‡ºï¼š
# [
#   {
#     "Type": "volume",
#     "Name": "nacos_nacos_data",
#     "Source": "/var/lib/docker/volumes/nacos_nacos_data/_data",
#     ...
#   }
# ]
```

---

### æ–¹æ³• 4ï¼šæŸ¥çœ‹å·çš„è¯¦ç»†ä¿¡æ¯

```bash
docker volume inspect nacos_nacos_data

# è¾“å‡ºï¼š
# [
#   {
#     "CreatedAt": "2025-12-10T...",
#     "Driver": "local",
#     "Labels": {
#       "com.docker.compose.project": "nacos",
#       "com.docker.compose.volume": "nacos_data"
#     },
#     "Mountpoint": "/var/lib/docker/volumes/nacos_nacos_data/_data",
#     "Name": "nacos_nacos_data",
#     ...
#   }
# ]
```

**å…³é”®ä¿¡æ¯ï¼š**
- `Name`: å®é™…å·åï¼ˆ`nacos_nacos_data`ï¼‰
- `Labels`: åŒ…å«é¡¹ç›®åå’Œå·åä¿¡æ¯

---

## ğŸ’¡ å®é™…åœºæ™¯åˆ†æ

### åœºæ™¯ 1ï¼šä¸¤ä¸ªç‹¬ç«‹çš„ Nacos å®ä¾‹

**ç›®å½•ç»“æ„ï¼š**
```
docker/
â”œâ”€â”€ nacos1/
â”‚   â””â”€â”€ docker-compose.yml  # å·åï¼šdata
â””â”€â”€ nacos2/
    â””â”€â”€ docker-compose.yml  # å·åï¼šdata
```

**ç»“æœï¼š**
- `nacos1_data` - Nacos1 çš„æ•°æ®
- `nacos2_data` - Nacos2 çš„æ•°æ®
- âœ… **ä¸ä¼šå†²çªï¼Œæ•°æ®ç‹¬ç«‹**

---

### åœºæ™¯ 2ï¼šNacos å’Œå¤‡ä»½æœåŠ¡å…±äº«æ•°æ®

**æ–‡ä»¶ï¼š** `docker/nacos/docker-compose.yml`
```yaml
services:
  nacos:
    volumes:
      - nacos_data:/home/nacos/data
  
  backup:
    volumes:
      - nacos_data:/backup  # å…±äº«åŒä¸€ä¸ªå·

volumes:
  nacos_data:
```

**ç»“æœï¼š**
- åªæœ‰ä¸€ä¸ªå·ï¼š`nacos_nacos_data`
- ä¸¤ä¸ªå®¹å™¨å…±äº«è¿™ä¸ªå·
- âœ… **è¿™æ˜¯è®¾è®¡å¦‚æ­¤ï¼Œç”¨äºæ•°æ®å…±äº«**

---

### åœºæ™¯ 3ï¼šä¸åŒé¡¹ç›®ä½¿ç”¨ç›¸åŒé¡¹ç›®å

```bash
# é¡¹ç›® 1
cd docker/mysql
docker compose -p shared up -d
# å·åï¼šshared_data

# é¡¹ç›® 2
cd docker/redis
docker compose -p shared up -d
# å·åï¼šshared_dataï¼ˆåŒä¸€ä¸ªå·ï¼ï¼‰
```

**ç»“æœï¼š**
- âš ï¸ **ä¼šå…±äº«åŒä¸€ä¸ªå·**
- å¦‚æœä¸æƒ³å…±äº«ï¼Œä½¿ç”¨ä¸åŒçš„é¡¹ç›®åæˆ–ä½¿ç”¨ `external: true` æŒ‡å®šä¸åŒåç§°

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. è®© Docker è‡ªåŠ¨ç®¡ç†ï¼ˆæ¨èï¼‰

```yaml
# ç®€å•å†™ï¼Œè®© Docker è‡ªåŠ¨åŠ å‰ç¼€
volumes:
  - data:/var/lib/mysql

volumes:
  data:
```

**ä¼˜ç‚¹ï¼š**
- âœ… ç®€å•ï¼Œä¸éœ€è¦è€ƒè™‘å‘½åå†²çª
- âœ… ä¸åŒé¡¹ç›®è‡ªåŠ¨éš”ç¦»

---

### 2. æ˜ç¡®æŒ‡å®šå·åï¼ˆéœ€è¦å…±äº«æ—¶ï¼‰

```yaml
volumes:
  data:
    name: my_custom_volume_name  # å›ºå®šåç§°
```

**ä¼˜ç‚¹ï¼š**
- âœ… å¯ä»¥è·¨é¡¹ç›®å…±äº«
- âœ… åç§°æ¸…æ™°

---

### 3. ä½¿ç”¨å¤–éƒ¨å·ï¼ˆå¤ç”¨å·²æœ‰å·ï¼‰

```yaml
volumes:
  data:
    external: true
    name: existing_volume_name  # ä½¿ç”¨å·²å­˜åœ¨çš„å·
```

**ä¼˜ç‚¹ï¼š**
- âœ… å¯ä»¥å¤ç”¨å…¶ä»–é¡¹ç›®åˆ›å»ºçš„å·
- âœ… ç²¾ç¡®æ§åˆ¶

---

## â“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ç¡®ä¿ä¸¤ä¸ªå®¹å™¨ä¸å…±äº«æ•°æ®ï¼Ÿ

**A:** ä½¿ç”¨ä¸åŒçš„å·åæˆ–ä¸åŒçš„é¡¹ç›®åï¼š

```yaml
# æ–¹æ³•1: ä½¿ç”¨ä¸åŒçš„å·å
volumes:
  - nacos1_data:/data
  - nacos2_data:/data

# æ–¹æ³•2: ä½¿ç”¨ä¸åŒçš„é¡¹ç›®å
docker compose -p nacos1 up -d
docker compose -p nacos2 up -d
```

---

### Q: å¦‚ä½•è®©ä¸¤ä¸ªå®¹å™¨å…±äº«æ•°æ®ï¼Ÿ

**A:** ä½¿ç”¨ç›¸åŒçš„å·åï¼ˆåŒä¸€é¡¹ç›®å†…ï¼‰ï¼š

```yaml
services:
  app1:
    volumes:
      - shared_data:/data
  
  app2:
    volumes:
      - shared_data:/data  # åŒä¸€ä¸ªå·

volumes:
  shared_data:
```

---

### Q: å¦‚ä½•æŸ¥çœ‹å·å±äºå“ªä¸ªé¡¹ç›®ï¼Ÿ

**A:**

```bash
# æŸ¥çœ‹å·çš„æ ‡ç­¾
docker volume inspect å·å | jq '.[0].Labels'

# è¾“å‡ºï¼š
# {
#   "com.docker.compose.project": "nacos",
#   "com.docker.compose.volume": "nacos_data"
# }
```

---

### Q: åˆ é™¤é¡¹ç›®ä¼šåˆ é™¤å·å—ï¼Ÿ

**A:** é»˜è®¤ä¸ä¼šï¼Œéœ€è¦ä½¿ç”¨ `-v` å‚æ•°ï¼š

```bash
# åªåˆ é™¤å®¹å™¨ï¼Œä¿ç•™å·
docker compose down

# åˆ é™¤å®¹å™¨å’Œå·
docker compose down -v
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **å‘½åå·æ˜¯ç‹¬ç«‹çš„** - ä¸ä¾èµ–å®¹å™¨ï¼Œåˆ é™¤å®¹å™¨ä¸ä¼šåˆ é™¤å·
2. **é‡æ–°å¯åŠ¨ä¼šå¤ç”¨å·** - æ•°æ®ä¼šæ¢å¤
3. **Docker è‡ªåŠ¨åŠ å‰ç¼€** - `é¡¹ç›®å_å·å`ï¼Œä¸åŒé¡¹ç›®ä¸ä¼šå†²çª
4. **åŒä¸€é¡¹ç›®å†…åŒåå·ä¼šå…±äº«** - è¿™æ˜¯è®¾è®¡å¦‚æ­¤ï¼Œç”¨äºæ•°æ®å…±äº«

### å‘½åè§„åˆ™

```
å®é™…å·å = é¡¹ç›®å_å·å

é¡¹ç›®åæ¥æºï¼š
1. ç›®å½•åï¼ˆé»˜è®¤ï¼‰
2. -p å‚æ•°æŒ‡å®š
3. COMPOSE_PROJECT_NAME ç¯å¢ƒå˜é‡
```

### è®°å¿†å£è¯€

> **å·æ˜¯ç‹¬ç«‹çš„ï¼Œåå­—æœ‰å‰ç¼€**  
> **ä¸åŒé¡¹ç›®ä¸å†²çªï¼ŒåŒä¸€é¡¹ç›®ä¼šå…±äº«**  
> **åˆ é™¤å®¹å™¨å·è¿˜åœ¨ï¼Œé‡æ–°å¯åŠ¨æ•°æ®æ¢å¤**

---

**æœ€åæ›´æ–°**: 2025-12-10
