# Docker Compose æœ€ç®€å•æ•™ç¨‹

> åªè®²æœ€åŸºç¡€çš„å‚æ•°ï¼Œèƒ½å¯åŠ¨èµ·æ¥å°±è¡Œ

## ğŸ“‹ ç›®å½•

- [æœ€ç®€å•çš„ compose æ–‡ä»¶](#æœ€ç®€å•çš„-compose-æ–‡ä»¶)
- [å¿…é¡»çš„å‚æ•°](#å¿…é¡»çš„å‚æ•°)
- [å¸¸ç”¨å‚æ•°](#å¸¸ç”¨å‚æ•°)
- [æœ€ç®€å•çš„ç¤ºä¾‹](#æœ€ç®€å•çš„ç¤ºä¾‹)
- [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)

---

## ğŸ¯ æœ€ç®€å•çš„ compose æ–‡ä»¶

ä¸€ä¸ªæœ€ç®€å•çš„ `docker-compose.yml` åªéœ€è¦ 3 ä¸ªå‚æ•°å°±èƒ½å¯åŠ¨ï¼š

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
```

**è§£é‡Šï¼š**
- `version`: compose æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬ï¼ˆå¿…é¡»å†™ï¼‰
- `services`: å®šä¹‰æœåŠ¡ï¼ˆå¿…é¡»å†™ï¼‰
- `web`: æœåŠ¡åç§°ï¼ˆéšä¾¿èµ·åï¼‰
- `image`: ä½¿ç”¨å“ªä¸ªé•œåƒï¼ˆå¿…é¡»å†™ï¼‰
- `ports`: ç«¯å£æ˜ å°„ï¼ˆå¿…é¡»å†™ï¼Œæ ¼å¼ï¼š`"å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£"`ï¼‰

è¿è¡Œï¼š`docker compose up -d`

è®¿é—®ï¼š`http://localhost:8080` å°±èƒ½çœ‹åˆ° nginx é¡µé¢äº†ï¼

---

## âœ… å¿…é¡»çš„å‚æ•°

### 1. `version` - ç‰ˆæœ¬å·

```yaml
version: '3.8'  # å¿…é¡»å†™ï¼Œæ¨èç”¨ 3.8
```

**ä½œç”¨ï¼š** å‘Šè¯‰ Docker Compose ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„é…ç½®æ ¼å¼

**å¯é€‰å€¼ï¼š** `'3.6'`, `'3.7'`, `'3.8'`ï¼ˆæ¨èç”¨ 3.8ï¼‰

---

### 2. `services` - æœåŠ¡å®šä¹‰

```yaml
services:
  æœåŠ¡å:
    image: é•œåƒå
```

**ä½œç”¨ï¼š** å®šä¹‰è¦å¯åŠ¨çš„å®¹å™¨æœåŠ¡

**è¯´æ˜ï¼š** 
- `services:` æ˜¯å›ºå®šå…³é”®å­—
- `æœåŠ¡å` éšä¾¿èµ·ï¼Œæ¯”å¦‚ `web`ã€`db`ã€`redis` ç­‰

---

### 3. `image` - é•œåƒåç§°

```yaml
image: nginx:latest
```

**ä½œç”¨ï¼š** æŒ‡å®šä½¿ç”¨å“ªä¸ª Docker é•œåƒ

**æ ¼å¼ï¼š** `é•œåƒå:æ ‡ç­¾`
- `nginx:latest` - æœ€æ–°ç‰ˆæœ¬
- `nginx:1.25` - æŒ‡å®šç‰ˆæœ¬
- `mysql:8.0` - MySQL 8.0

**å¿…é¡»å†™ï¼Œå¦åˆ™ä¸çŸ¥é“å¯åŠ¨ä»€ä¹ˆï¼**

---

## ğŸ”§ å¸¸ç”¨å‚æ•°

### `ports` - ç«¯å£æ˜ å°„

```yaml
ports:
  - "8080:80"        # å®¿ä¸»æœº8080ç«¯å£ -> å®¹å™¨80ç«¯å£
  - "3306:3306"      # å®¿ä¸»æœº3306ç«¯å£ -> å®¹å™¨3306ç«¯å£
```

**ä½œç”¨ï¼š** æŠŠå®¹å™¨å†…çš„ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œè¿™æ ·å°±èƒ½ä»å¤–é¢è®¿é—®äº†

**æ ¼å¼ï¼š** `"å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£"`

**ç¤ºä¾‹ï¼š**
- `"8080:80"` - è®¿é—® `localhost:8080` å°±æ˜¯è®¿é—®å®¹å™¨çš„ 80 ç«¯å£
- `"7474:7474"` - è®¿é—® `localhost:7474` å°±æ˜¯è®¿é—®å®¹å™¨çš„ 7474 ç«¯å£

---

### `volumes` - æ•°æ®å·ï¼ˆæŒä¹…åŒ–ï¼‰

```yaml
volumes:
  - ./data:/data              # å½“å‰ç›®å½•çš„dataæ–‡ä»¶å¤¹ -> å®¹å™¨çš„/data
  - my_volume:/var/lib/mysql  # å‘½åå· -> å®¹å™¨çš„/var/lib/mysql
```

**ä½œç”¨ï¼š** æŠŠæ•°æ®ä¿å­˜åˆ°å®¿ä¸»æœºï¼Œå®¹å™¨åˆ äº†æ•°æ®è¿˜åœ¨

**ä¸¤ç§å†™æ³•ï¼š**

1. **ç›®å½•æ˜ å°„**ï¼ˆå¸¸ç”¨ï¼‰
   ```yaml
   volumes:
     - ./data:/data  # å½“å‰ç›®å½•ä¸‹çš„dataæ–‡ä»¶å¤¹æ˜ å°„åˆ°å®¹å™¨çš„/data
   ```

2. **å‘½åå·**ï¼ˆæ¨èï¼‰
   ```yaml
   volumes:
     - my_data:/data
   
   volumes:  # åœ¨æ–‡ä»¶æœ€ä¸‹é¢å®šä¹‰
     my_data:
   ```

---

### `environment` - ç¯å¢ƒå˜é‡

```yaml
environment:
  - MYSQL_ROOT_PASSWORD=123456
  - TZ=Asia/Shanghai
```

**ä½œç”¨ï¼š** è®¾ç½®å®¹å™¨çš„ç¯å¢ƒå˜é‡ï¼Œå¾ˆå¤šæœåŠ¡éœ€è¦è¿™ä¸ªæ¥é…ç½®

**æ ¼å¼ï¼š** `å˜é‡å=å€¼`

**ç¤ºä¾‹ï¼š**
- `MYSQL_ROOT_PASSWORD=123456` - MySQL çš„ root å¯†ç 
- `NEO4J_AUTH=neo4j/password` - Neo4j çš„ç”¨æˆ·å/å¯†ç 
- `TZ=Asia/Shanghai` - æ—¶åŒºè®¾ç½®

---

### `container_name` - å®¹å™¨åç§°

```yaml
container_name: my-nginx
```

**ä½œç”¨ï¼š** ç»™å®¹å™¨èµ·ä¸ªåå­—ï¼Œæ–¹ä¾¿ç®¡ç†

**ä¸å†™çš„è¯ï¼š** Docker ä¼šè‡ªåŠ¨ç”Ÿæˆåå­—ï¼ˆé€šå¸¸æ˜¯ `ç›®å½•å_æœåŠ¡å_1`ï¼‰

---

### `restart` - é‡å¯ç­–ç•¥

```yaml
restart: always
```

**ä½œç”¨ï¼š** å®¹å™¨æŒ‚äº†è‡ªåŠ¨é‡å¯

**å¯é€‰å€¼ï¼š**
- `always` - æ€»æ˜¯é‡å¯ï¼ˆæ¨èï¼‰
- `unless-stopped` - é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™é‡å¯
- `no` - ä¸è‡ªåŠ¨é‡å¯ï¼ˆé»˜è®¤ï¼‰

---

## ğŸ“ æœ€ç®€å•çš„ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå¯åŠ¨ Nginxï¼ˆæœ€ç®€å•ï¼‰

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
```

**è¿è¡Œï¼š** `docker compose up -d`

**è®¿é—®ï¼š** http://localhost:8080

---

### ç¤ºä¾‹ 2ï¼šå¯åŠ¨ MySQLï¼ˆåŠ ç¯å¢ƒå˜é‡ï¼‰

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=123456
```

**è¿è¡Œï¼š** `docker compose up -d`

**è¿æ¥ï¼š** `mysql -h localhost -P 3306 -u root -p123456`

---

### ç¤ºä¾‹ 3ï¼šå¯åŠ¨ Redisï¼ˆåŠ æ•°æ®æŒä¹…åŒ–ï¼‰

```yaml
version: '3.8'

services:
  redis:
    image: redis:latest
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  redis_data:
```

**è¿è¡Œï¼š** `docker compose up -d`

**è¿æ¥ï¼š** `redis-cli -h localhost -p 6379`

---

### ç¤ºä¾‹ 4ï¼šå¯åŠ¨ Neo4jï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰

```yaml
version: '3.8'

services:
  neo4j:
    image: neo4j:latest
    container_name: neo4j
    restart: always
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      - NEO4J_AUTH=neo4j/password
    volumes:
      - neo4j_data:/data

volumes:
  neo4j_data:
```

**è¿è¡Œï¼š** `docker compose up -d`

**è®¿é—®ï¼š** http://localhost:7474ï¼ˆç”¨æˆ·åï¼šneo4jï¼Œå¯†ç ï¼špasswordï¼‰

---

## ğŸš€ å¸¸ç”¨å‘½ä»¤

### å¯åŠ¨å’Œåœæ­¢

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰
docker compose up -d

# å¯åŠ¨æœåŠ¡ï¼ˆå‰å°è¿è¡Œï¼Œçœ‹æ—¥å¿—ï¼‰
docker compose up

# åœæ­¢æœåŠ¡
docker compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆæ•°æ®ä¼šä¸¢å¤±ï¼ï¼‰
docker compose down -v
```

### æŸ¥çœ‹çŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„æ—¥å¿—
docker compose logs -f æœåŠ¡å
```

### å…¶ä»–æ“ä½œ

```bash
# é‡å¯æœåŠ¡
docker compose restart

# é‡å¯æŸä¸ªæœåŠ¡
docker compose restart æœåŠ¡å

# è¿›å…¥å®¹å™¨
docker compose exec æœåŠ¡å sh

# æ›´æ–°é•œåƒ
docker compose pull
docker compose up -d
```

---

## ğŸ’¡ å¿«é€Ÿå‚è€ƒ

### æœ€å°é…ç½®æ¨¡æ¿

```yaml
version: '3.8'

services:
  æœåŠ¡å:
    image: é•œåƒå:æ ‡ç­¾
    ports:
      - "å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£"
```

### å®Œæ•´é…ç½®æ¨¡æ¿

```yaml
version: '3.8'

services:
  æœåŠ¡å:
    image: é•œåƒå:æ ‡ç­¾
    container_name: å®¹å™¨å
    restart: always
    ports:
      - "8080:80"
    environment:
      - å˜é‡å=å€¼
    volumes:
      - æ•°æ®å·å:/å®¹å™¨å†…è·¯å¾„

volumes:
  æ•°æ®å·å:
```

---

## â“ å¸¸è§é—®é¢˜

### Q: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

**A:** æ¢ä¸ªç«¯å£å·ï¼Œæ¯”å¦‚æŠŠ `8080` æ”¹æˆ `8081`

```yaml
ports:
  - "8081:80"  # æ”¹æˆ8081
```

### Q: æ€ä¹ˆçŸ¥é“æœåŠ¡éœ€è¦ä»€ä¹ˆç¯å¢ƒå˜é‡ï¼Ÿ

**A:** çœ‹é•œåƒçš„æ–‡æ¡£ï¼Œæˆ–è€…å» Docker Hub æœé•œåƒåï¼Œçœ‹è¯´æ˜

### Q: æ•°æ®å·æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ

**A:** ä¿å­˜æ•°æ®ç”¨çš„ã€‚ä¸å†™æ•°æ®å·ï¼Œå®¹å™¨åˆ äº†æ•°æ®å°±æ²¡äº†ï¼›å†™äº†æ•°æ®å·ï¼Œæ•°æ®ä¼šä¿å­˜åˆ°å®¿ä¸»æœº

### Q: `restart: always` å’Œ `unless-stopped` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A:** 
- `always` - ä»»ä½•æ—¶å€™éƒ½é‡å¯ï¼ˆåŒ…æ‹¬æ‰‹åŠ¨åœæ­¢åï¼‰
- `unless-stopped` - æ‰‹åŠ¨åœæ­¢åä¸é‡å¯ï¼ˆæ¨èç”¨è¿™ä¸ªï¼‰

---

## ğŸ“š æ€»ç»“

**æœ€åŸºç¡€çš„ 3 ä¸ªå‚æ•°ï¼š**
1. `version` - ç‰ˆæœ¬å·
2. `services` - æœåŠ¡å®šä¹‰
3. `image` - é•œåƒåç§°

**æœ€å¸¸ç”¨çš„ 5 ä¸ªå‚æ•°ï¼š**
1. `ports` - ç«¯å£æ˜ å°„
2. `volumes` - æ•°æ®å·
3. `environment` - ç¯å¢ƒå˜é‡
4. `container_name` - å®¹å™¨å
5. `restart` - é‡å¯ç­–ç•¥

**è®°ä½ï¼š** åªè¦æœ‰äº† `version`ã€`services`ã€`image` å’Œ `ports`ï¼Œå°±èƒ½å¯åŠ¨ä¸€ä¸ªæœåŠ¡äº†ï¼

---

**æœ€åæ›´æ–°**: 2025-12-10

