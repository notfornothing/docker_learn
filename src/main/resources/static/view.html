<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸ¥çœ‹æ–‡æ¡£ - æ–‡æ¡£ç®¡ç†å™¨</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>ğŸ“š æ–‡æ¡£ç®¡ç†å™¨</h1>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <div style="margin-bottom: 1rem;">
                <a href="/" class="btn btn-secondary">â† è¿”å›é¦–é¡µ</a>
            </div>
            
            <div id="doc-viewer" class="doc-viewer">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </main>

    <script>
        async function loadDocument() {
            const urlParams = new URLSearchParams(window.location.search);
            const type = urlParams.get('type'); // 'docker' æˆ– 'doc'
            const name = urlParams.get('name'); // æœåŠ¡åæˆ–æ–‡ä»¶å
            
            if (!type || !name) {
                document.getElementById('doc-viewer').innerHTML = 
                    '<div class="error">ç¼ºå°‘å‚æ•°</div>';
                return;
            }

            try {
                let markdown = '';
                let title = name;
                
                if (type === 'docker') {
                    // è·å– Docker æœåŠ¡çš„ README
                    const response = await fetch(`/api/docker/services/${name}/readme`);
                    const result = await response.json();
                    
                    if (!result.readme) {
                        document.getElementById('doc-viewer').innerHTML = 
                            '<div class="error">è¯¥æœåŠ¡æš‚æ—  README æ–‡æ¡£</div>';
                        return;
                    }
                    
                    markdown = result.readme;
                    
                    // è·å–æœåŠ¡ä¿¡æ¯ä»¥è·å–æ ‡é¢˜
                    const serviceResponse = await fetch(`/api/docker/services/${name}`);
                    const service = await serviceResponse.json();
                    title = service.title || name;
                } else if (type === 'doc') {
                    // è·å–æ™®é€šæ–‡æ¡£
                    const response = await fetch(`/api/docs/${encodeURIComponent(name)}`);
                    const doc = await response.json();
                    markdown = doc.markdown;
                    title = name;
                }
                
                // è½¬æ¢ Markdown ä¸º HTMLï¼ˆåç«¯è§£æï¼‰
                const convertResponse = await fetch('/api/docs/convert', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ markdown })
                });
                const convertResult = await convertResponse.json();
                
                document.title = `${title} - æ–‡æ¡£ç®¡ç†å™¨`;
                
                const viewerHtml = `
                    <h1>${title}</h1>
                    <div class="doc-content">${convertResult.html}</div>
                `;
                
                document.getElementById('doc-viewer').innerHTML = viewerHtml;
            } catch (error) {
                document.getElementById('doc-viewer').innerHTML = 
                    '<div class="error">åŠ è½½å¤±è´¥: ' + error.message + '</div>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadDocument();
        });
    </script>
</body>
</html>







